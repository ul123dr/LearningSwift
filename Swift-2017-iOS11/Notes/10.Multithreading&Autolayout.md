# Lecture 10

## Multithreading

    å¤šçº¿ç¨‹å°±æ˜¯è®©æ‰€æœ‰çš„ä¸€åˆ‡é•¿è¿è¡Œçš„ä¸œè¥¿è¿œç¦»ä¸»çº¿ç¨‹ã€‚Multithreading is all about keeping long running things off of the main queue where the UI runs.

- Queues

å¤šçº¿ç¨‹ä¸»è¦æ˜¯å…³äºiOSä¸­çš„"é˜Ÿåˆ—"<br>
å‡½æ•°ï¼ˆé€šå¸¸æ˜¯é—­åŒ…ï¼‰æ€»æ˜¯ç®€å•çš„æ’åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼ˆä¾‹å¦‚ï¼šMovies)<br>
ç„¶åï¼Œå°†è¿™äº›å‡½æ•°ä»é˜Ÿåˆ—ä¸­æ‹‰å‡ºï¼Œå¹¶åœ¨å…³è”çš„çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚<br>
é˜Ÿåˆ—å¯ä»¥æ˜¯â€œä¸²è¡Œserialâ€ï¼ˆä¸€æ¬¡ä¸€ä¸ªé—­åŒ…ï¼‰æˆ–â€œå¹¶å‘concurrentâ€ï¼ˆå¤šä¸ªçº¿ç¨‹ä¸ºå…¶æä¾›æœåŠ¡ï¼‰

- Main Queue

iOSçš„ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—ã€‚<br>
æ‰€æœ‰UIæ´»åŠ¨éƒ½å¿…é¡»ä¸”åªèƒ½åœ¨è¯¥é˜Ÿåˆ—æ‰§è¡Œã€‚<br>
ç›¸åï¼Œåœ¨è¯¥é˜Ÿåˆ—ä¸Šä¸èƒ½å‡ºç°ä»»ä½•è€—æ—¶çš„éUIæ´»åŠ¨ã€‚<br>
æˆ‘ä»¬è¿™æ ·åšæ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ç”¨æˆ·ç•Œé¢å…·æœ‰é«˜åº¦çš„å“åº”æ€§ã€‚<br>
ä¹Ÿå› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨UIä¸­å‘ç”Ÿçš„äº‹æƒ…å¯ä»¥é¢„è§åœ°ï¼ˆè¿ç»­åœ°ï¼‰å‘ç”Ÿã€‚<br>
åªæœ‰å½“ä¸»é˜Ÿåˆ—å¤„äºâ€œå®‰é™â€çŠ¶æ€æ—¶ï¼Œæ‰ä¼šåœ¨ä¸»é˜Ÿåˆ—ä¸­å…³é—­å’Œå¤„ç†å‡½æ•°ã€‚

- Global Queue

å¯¹äºéä¸»é˜Ÿåˆ—å·¥ä½œï¼Œè¿˜éœ€è¦å…±äº«çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—ã€‚

- è·å¾—ä¸€ä¸ªé˜Ÿåˆ—

è·å¾—ä¸»é˜Ÿåˆ—
```swift
let mainQueue = DispatchQueue.main
```

è·å¾—Globalé˜Ÿåˆ—
```swift
let backgroudQueue = DispatchQueue.global(qos: DispatchQos)
DispatchQos.userInteractive // high priority, only do something short and quickï¼ˆæä¼˜å…ˆçº§ï¼Œåªèƒ½åšä¸€äº›å¿«é€Ÿå’ŒçŸ­æ“ä½œï¼‰
DispatchQos.userInitiated   // high priority, but might take a little bit of timeï¼ˆé«˜ä¼˜å…ˆçº§ï¼Œä½†å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´ï¼‰
DispatchQos.background      // not directly initiated by user, so can run as slow as neededï¼ˆä¸æ˜¯ç”¨æˆ·ç›´æ¥å¯åŠ¨ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œçš„å¾ˆæ…¢ï¼‰
DispatchQos.utility         // long-running background processed, low priorityï¼ˆä½ä¼˜å…ˆçº§ï¼Œé•¿æ—¶é—´è¿è¡Œåœ¨åå°å¤„ç†ï¼‰
```

- åœ¨é˜Ÿåˆ—ä¸­æ‰§è¡Œä»£ç å—

å¤šçº¿ç¨‹æœ‰ä¸¤ä¸ªä¸»è¦çš„æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªé—­åŒ…ä»£ç å—æ”¾å…¥é˜Ÿåˆ—ä¸­.

å¼‚æ­¥é˜Ÿåˆ—ï¼Œå°†é—­åŒ…ä»£ç å—æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¹¶æŒç»­è¿è¡Œå½“å‰é˜Ÿåˆ—
```swift
queue.async { ... }
```

åŒæ­¥é˜Ÿåˆ—ï¼Œè®©å½“å‰é˜Ÿåˆ—ç­‰å¾…ï¼Œç›´åˆ°ä»£ç å—é˜Ÿåˆ—æ‰§è¡Œå®Œæˆ
```swift
queue.sync { ... }
```

- è·å¾—ä¸€ä¸ª `non-global` é˜Ÿåˆ—ï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼‰

é€šè¿‡è°ƒç”¨ `DispatchQueue` åˆå§‹åŒ–è‡ªå·±çš„é˜Ÿåˆ—ï¼ˆä»…å½“æœ‰å¤šä¸ªè¿ç»­ä¾èµ–æ´»åŠ¨æ—¶è°ƒç”¨ï¼‰<br>
å°†åœ¨è°ƒè¯•å™¨ä¸­å±•ç¤ºæ­£åœ¨ä½¿ç”¨å“ªä¸ª `label` é˜Ÿåˆ—
```swift
let serialQueue = DispatchQueue(label: "MySerialQ")
```

å¹¶å‘ï¼ˆä¸å…¨å±€é˜Ÿåˆ— `global queue` ç›¸æ¯”ï¼Œå¾ˆå°‘è¿™æ ·ä½¿ç”¨ï¼‰
```swift
let concurrentQueue = DispatchQueue(label: "MyConcurrentQ", attributes: .concurrent)
```

- GCD(Grand Central Dispatch)

å¯ä»¥æ‰§è¡Œé”å®šã€ä¿æŠ¤ä¸´ç•ŒåŒºï¼Œè¯»å–å™¨å’Œå†™å…¥å™¨ï¼ŒåŒæ­¥è°ƒåº¦ç­‰<br>
æ„Ÿå…´è¶£è‡ªå·±æŸ¥æ–‡æ¡£ğŸ˜…

- OperationQueue å’Œ Operation

é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ `OperationQueue` ï¼Œå› ä¸º"åµŒå¥—"ä»£ç è¯»èµ·æ¥å¾ˆå‹å¥½ã€‚<br>
`OperationQueue` æ˜¯ `grand central dispatch` çš„ä¸€éƒ¨åˆ†ã€‚<br>
è‡ªå·±æŸ¥æ–‡æ¡£ğŸ˜…

- å¤šçº¿ç¨‹iOS APIä¾‹å­

æ­¤ `API` å…è®¸å°† `http url` çš„å†…å®¹æå–åˆ°ä¸»é˜Ÿåˆ—ä¹‹å¤–çš„æ•°æ®ä¸­ã€‚
```swift
let session = URLSession(configuration: .default)
if let url = URL(string; "http:stanford.edu/...") {
    let task = session.detaTask(with: url) { (data: Data?, response, error) in
        // I want to do UI things here
        // with the data of the download
        // can I?
    }
    task.resume()
}
```
NO. è¿™æ˜¯å› ä¸ºä»£ç å°†åœ¨ä¸»é˜Ÿåˆ—ä¹‹å¤–è¿è¡Œã€‚

å¯¹ä»¥ä¸Šä»£ç æ·»åŠ  `DispatchQueue.main.async` + é—­åŒ…
```swift
let session = URLSession(configuration: .default)
if let url = URL(string; "http:stanford.edu/...") {
    let task = session.detaTask(with: url) { (data: Data?, response, error) in
        DispatchQueue.main.async {
            // do UI stuff here
        }
    }
    task.resume()
}
```
è¿™é‡Œå°±å¯ä»¥åˆæ³•çš„åšç”¨æˆ·ç•Œé¢æ“ä½œäº†ï¼Œå› ä¸ºå®ƒå·²ç»å›åˆ°äº†ä¸»é˜Ÿåˆ—ã€‚

- é˜Ÿåˆ—è¿è¡Œæ—¶æœºï¼ˆTiming)
```swift
a: if let url = URL(string: â€œhttp://stanford.edu/...â€) {
b:      let task = session.dataTask(with: url) { (data: Data?, response, error) in
c:          // do something with the data
d:          DispatchQueue.main.async {
e:              // do UI stuff here
            }
f:          print(â€œdid some stuff with the data, but UI part hasnâ€™t happened yetâ€)
        }
g:      task.resume()
    }
h: print(â€œdone firing off the request for the urlâ€™s contentsâ€)
```
æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼ša b g h c d f e <br>
a: ç¬¬ä¸€ä¸ªæ‰§è¡Œã€‚<br>
b: ç«‹å³è¿”å›ä¸€ä¸ªtaskï¼Œè¿™é‡Œé—­åŒ…è¿˜æœªæ‰§è¡Œã€‚<br>
g: ç´§è·Ÿbæ‰§è¡Œï¼Œç«‹å³è¿”å›ï¼Œå®ƒåšçš„äº‹æƒ…æ˜¯åœ¨å¦ä¸€ä¸ªé˜Ÿåˆ—ä¸Šè§¦å‘ `url fetching task`ï¼ˆæˆ–è·å–æ•°æ®ï¼‰ã€‚<br>
h: ç„¶åæ‰§è¡Œï¼Œæ­¤æ—¶ `url fetching task` ä¼šåœ¨å¦ä¸€ä¸ªé˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚<br>
å‰å››è¡Œä»£ç ï¼ˆaã€bã€gã€hï¼‰éƒ½è¿ç»­è¿è¡Œï¼Œæ²¡æœ‰å»¶è¿Ÿã€‚<br>
c: è¯¥è¡Œç¨åæ‰ä¼šæ‰§è¡Œï¼ˆå› ä¸ºæ­£åœ¨ç­‰å¾…æ•°æ®ï¼‰ï¼Œå¯èƒ½åœ¨gåçš„ç¨åæˆ–å‡ åˆ†é’Ÿæ‰§è¡Œï¼ˆä¾‹å¦‚é€šè¿‡èœ‚çªç½‘ç»œï¼‰ã€‚<br>
d: åœ¨cä¹‹åæ‰§è¡Œï¼Œç”±äºå…¶æ­£åœ¨å°†é—­åŒ…è°ƒåº¦åˆ°ä¸»çº¿ç¨‹asyncï¼Œè¡Œdå°†ç«‹å³é˜²è¿”å›ã€‚<br>
f: fè¡Œåœ¨dè¡Œä¹‹åç«‹å³æ‰§è¡Œã€‚<br>
eçº¿è¿˜æ²¡å‘ç”Ÿï¼<br>
åŒæ ·ï¼Œè¡Œdé™¤äº†å¼‚æ­¥åœ°å°†è¡Œeåˆ†æ´¾åˆ°ï¼ˆä¸»ï¼‰é˜Ÿåˆ—ä¹‹å¤–ä»€ä¹ˆä¹Ÿæ²¡æœ‰åšã€‚<br>
e: æœ€åï¼Œä¸€æ®µæ—¶é—´åï¼Œeè¡Œè¢«æ‰§è¡Œã€‚<br>
å°±åƒcçº¿ä¸€æ ·ï¼Œæœ€å¥½æƒ³è±¡ä¸€ä¸‹è¿™å‘ç”Ÿåœ¨gçº¿å‡ åˆ†é’Ÿåã€‚<br>
åœ¨é‚£ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¯èƒ½å‘ç”Ÿäº†å·¨å¤§çš„å˜åŒ–ã€‚<br>

## Autolayout

- Size Class

åœ¨UIViewControllerä¸­ä½¿ç”¨ä¸‹é¢æ–¹æ³•å¯ä»¥æ‰¾åˆ°å½“å‰çš„ `size class`
```swift
let myHorizSizeClass: UIUserInterfaceSizeClass = traitCollection.horizontalSizeClass
```
è¿”å›å€¼æ˜¯æšä¸¾â€¦æˆ–è€… `.compact` æˆ–è€… `.regular` ï¼ˆæˆ–è€… `.unspecified` ï¼‰ã€‚<br>
ç„¶è€Œï¼Œåœ¨ä»£ç ä¸­å¾ˆå°‘çœ‹åˆ°sizeç±»ã€‚

- å®šä¹‰æ¨ªå±ä¸ç«–å±æ¨¡å¼
é€šè¿‡ `traitCollection` å¯ä»¥è®¾ç½®æ¨ªå±çº¦æŸä¸ç«–å±çº¦æŸ

æ¨ªå±çº¦æŸ
![](https://github.com/ul123dr/StudySwift/blob/master/Notes/Autolayout-width.png)

ç«–å±çº¦æŸ
![](https://github.com/ul123dr/StudySwift/blob/master/Notes/Autolayout-height.png)
